<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIMI翻译器 - 专业多语言翻译平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#8B5CF6',
                        inputText: '#666666',
                        outputText: '#2a9d8f',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .bg-gradient-custom {
                background: linear-gradient(135deg, #4F46E5, #8B5CF6);
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .translate-smooth {
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
        }
    </style>
</head>
<body class="bg-gradient-custom min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="sticky top-0 z-50 bg-white bg-opacity-95 backdrop-blur-sm shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-language text-primary text-2xl"></i>
                <h1 class="text-2xl font-bold text-primary">MIMI翻译器</h1>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300 font-medium">翻译</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300">文档翻译</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300">图片翻译</a>
                <a href="#" class="text-gray-700 hover:text-primary transition-all-300">语音翻译</a>
            </nav>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-all-300">
                    <i class="fa fa-moon-o text-gray-600"></i>
                </button>
                <button class="hidden md:block bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all-300">
                    登录
                </button>
                <button class="md:hidden p-2 rounded-full hover:bg-gray-100 transition-all-300">
                    <i class="fa fa-bars text-gray-600"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主要翻译区域 -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- 翻译选项 -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex space-x-4">
                        <select id="source-language" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300">
                            <option value="auto">自动检测</option>
                            <option value="zh">中文</option>
                            <option value="en">英语</option>
                            <option value="ja">日语</option>
                            <option value="ko">韩语</option>
                            <option value="fr">法语</option>
                            <option value="de">德语</option>
                            <option value="es">西班牙语</option>
                            <option value="ru">俄语</option>
                        </select>
                        <button id="swap-languages" class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition-all-300">
                            <i class="fa fa-exchange"></i>
                        </button>
                        <select id="target-language" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300">
                            <option value="zh">中文</option>
                            <option value="en">英语</option>
                            <option value="ja">日语</option>
                            <option value="ko">韩语</option>
                            <option value="fr">法语</option>
                            <option value="de">德语</option>
                            <option value="es">西班牙语</option>
                            <option value="ru">俄语</option>
                        </select>
                    </div>
                    <div class="flex space-x-2">
                        <button class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all-300" title="文本转语音">
                            <i class="fa fa-volume-up"></i>
                        </button>
                        <button class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all-300" title="复制">
                            <i class="fa fa-copy"></i>
                        </button>
                        <button id="clear-source" class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all-300" title="清空">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 输入区域 -->
                <div class="mb-6">
                    <textarea 
                        id="source-text" 
                        class="w-full h-32 p-4 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all-300 resize-none"
                        placeholder="请输入要翻译的文本..."
                        style="color: #666666;"
                    ></textarea>
                    <div class="text-right text-sm text-gray-500 mt-1">
                        <span id="char-count">0</span> 字符
                    </div>
                </div>
                
                <!-- 翻译按钮 -->
                <div class="text-center">
                    <button 
                        id="translate-btn" 
                        class="bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-lg shadow-md hover:shadow-lg transition-all-300 flex items-center justify-center mx-auto w-full max-w-xs"
                    >
                        <i class="fa fa-language mr-2"></i>
                        <span>立即翻译</span>
                    </button>
                </div>
            </div>
            
            <!-- 结果区域 -->
            <div class="bg-white rounded-lg shadow-lg p-6 relative">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-gray-500">
                        <span id="detected-language">检测语言</span>
                        <span> → </span>
                        <span id="result-language">目标语言</span>
                    </div>
                    <div class="flex space-x-2">
                        <button class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all-300" title="文本转语音">
                            <i class="fa fa-volume-up"></i>
                        </button>
                        <button id="copy-result" class="p-2 rounded-full hover:bg-gray-100 text-gray-600 transition-all-300" title="复制">
                            <i class="fa fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 输出区域 -->
                <div id="result-container" class="min-h-[128px] p-4 border border-gray-200 rounded-lg bg-gray-50 transition-all-300">
                    <div id="translation-result" class="whitespace-pre-wrap break-words" style="color: #2a9d8f;">
                        翻译结果将显示在这里
                    </div>
                    <div id="loading-indicator" class="hidden flex items-center justify-center h-32">
                        <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary"></div>
                    </div>
                </div>
                
                <!-- 更多功能 -->
                <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button class="flex flex-col items-center justify-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all-300">
                        <i class="fa fa-picture-o text-primary text-xl mb-1"></i>
                        <span class="text-sm">图片翻译</span>
                    </button>
                    <button class="flex flex-col items-center justify-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all-300">
                        <i class="fa fa-file-text-o text-primary text-xl mb-1"></i>
                        <span class="text-sm">文档翻译</span>
                    </button>
                    <button class="flex flex-col items-center justify-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all-300">
                        <i class="fa fa-comment-o text-primary text-xl mb-1"></i>
                        <span class="text-sm">对话翻译</span>
                    </button>
                    <button class="flex flex-col items-center justify-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all-300">
                        <i class="fa fa-history text-primary text-xl mb-1"></i>
                        <span class="text-sm">翻译历史</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部信息 -->
    <footer class="bg-white bg-opacity-95 backdrop-blur-sm mt-12 py-8 border-t border-gray-100">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-primary">MIMI翻译器</h3>
                    <p class="text-gray-600 text-sm">提供专业、准确、快速的多语言翻译服务，支持文本、文档、图片和语音翻译。</p>
                </div>
                <div>
                    <h4 class="font-medium mb-4 text-gray-800">翻译服务</h4>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li><a href="#" class="hover:text-primary transition-all-300">文本翻译</a></li>
                        <li><a href="#" class="hover:text-primary transition-all-300">文档翻译</a></li>
                        <li><a href="#" class="hover:text-primary transition-all-300">图片翻译</a></li>
                        <li><a href="#" class="hover:text-primary transition-all-300">语音翻译</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium mb-4 text-gray-800">关于我们</h4>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li><a href="#" class="hover:text-primary transition-all-300">公司介绍</a></li>
                        <li><a href="#" class="hover:text-primary transition-all-300">联系我们</a></li>
                        <li><a href="#" class="hover:text-primary transition-all-300">隐私政策</a></li>
                        <li><a href="#" class="hover:text-primary transition-all-300">使用条款</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium mb-4 text-gray-800">关注我们</h4>
                    <div class="flex space-x-4 mb-4">
                        <a href="#" class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary/20 transition-all-300">
                            <i class="fa fa-weixin"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary/20 transition-all-300">
                            <i class="fa fa-weibo"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary hover:bg-primary/20 transition-all-300">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                    <p class="text-sm text-gray-500">© 2023 MIMI翻译器. 保留所有权利.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 通知提示 -->
    <div id="notification" class="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <i class="fa fa-check-circle mr-2"></i>
        <span id="notification-message">操作成功</span>
    </div>

    <script>
        // DOM 元素引用
        const sourceText = document.getElementById('source-text');
        const translationResult = document.getElementById('translation-result');
        const translateBtn = document.getElementById('translate-btn');
        const sourceLanguage = document.getElementById('source-language');
        const targetLanguage = document.getElementById('target-language');
        const swapLanguagesBtn = document.getElementById('swap-languages');
        const clearSourceBtn = document.getElementById('clear-source');
        const copyResultBtn = document.getElementById('copy-result');
        const charCount = document.getElementById('char-count');
        const loadingIndicator = document.getElementById('loading-indicator');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        const detectedLanguageEl = document.getElementById('detected-language');
        const resultLanguageEl = document.getElementById('result-language');
        
        // 增强的翻译字典，包含更多常用单词
        const translationDictionary = {
            'en': {
                'zh': {
                    'hello': '你好',
                    'world': '世界',
                    'handsome': '帅气的',
                    'beautiful': '美丽的',
                    'good': '好的',
                    'bad': '坏的',
                    'yes': '是',
                    'no': '否',
                    'thank': '谢谢',
                    'you': '你',
                    'i': '我',
                    'he': '他',
                    'she': '她',
                    'we': '我们',
                    'they': '他们',
                    'love': '爱',
                    'like': '喜欢',
                    'hate': '讨厌',
                    'friend': '朋友',
                    'family': '家庭',
                    'work': '工作',
                    'school': '学校',
                    'computer': '电脑',
                    'phone': '手机',
                    'book': '书',
                    'time': '时间',
                    'day': '天',
                    'night': '晚上',
                    'year': '年',
                    'month': '月',
                    'week': '周',
                    'money': '钱',
                    'food': '食物',
                    'water': '水',
                    'fire': '火',
                    'earth': '地球',
                    'sky': '天空',
                    'sun': '太阳',
                    'moon': '月亮',
                    'star': '星星',
                    'red': '红色',
                    'blue': '蓝色',
                    'green': '绿色',
                    'yellow': '黄色',
                    'black': '黑色',
                    'white': '白色',
                    'big': '大的',
                    'small': '小的',
                    'happy': '快乐的',
                    'sad': '悲伤的',
                    'angry': '生气的',
                    'excited': '兴奋的',
                    'tired': '累的',
                    'hungry': '饿的',
                    'thirsty': '渴的',
                    'hot': '热的',
                    'cold': '冷的',
                    'new': '新的',
                    'old': '旧的',
                    'right': '正确的',
                    'wrong': '错误的',
                    'fast': '快的',
                    'slow': '慢的',
                    'high': '高的',
                    'low': '低的',
                    'long': '长的',
                    'short': '短的',
                    'strong': '强壮的',
                    'weak': '弱的',
                    'smart': '聪明的',
                    'stupid': '愚蠢的',
                    'easy': '容易的',
                    'difficult': '困难的',
                    'early': '早的',
                    'late': '晚的',
                    'first': '第一',
                    'last': '最后',
                    'one': '一',
                    'two': '二',
                    'three': '三',
                    'four': '四',
                    'five': '五',
                    'six': '六',
                    'seven': '七',
                    'eight': '八',
                    'nine': '九',
                    'ten': '十',
                    'hundred': '百',
                    'thousand': '千',
                    'million': '百万',
                    'and': '和',
                    'or': '或者',
                    'but': '但是',
                    'because': '因为',
                    'so': '所以',
                    'if': '如果',
                    'when': '当',
                    'where': '哪里',
                    'why': '为什么',
                    'how': '如何',
                    'what': '什么',
                    'who': '谁',
                    'which': '哪一个',
                    'this': '这个',
                    'that': '那个',
                    'these': '这些',
                    'those': '那些',
                    'my': '我的',
                    'your': '你的',
                    'his': '他的',
                    'her': '她的',
                    'our': '我们的',
                    'their': '他们的',
                    'with': '和',
                    'without': '没有',
                    'in': '在...里',
                    'on': '在...上',
                    'at': '在',
                    'to': '到',
                    'for': '为了',
                    'from': '从',
                    'by': '通过',
                    'about': '关于',
                    'of': '的',
                    'off': '关闭',
                    'up': '上',
                    'down': '下',
                    'left': '左',
                    'right': '右',
                    'go': '去',
                    'come': '来',
                    'take': '拿',
                    'give': '给',
                    'make': '做',
                    'do': '做',
                    'say': '说',
                    'speak': '说',
                    'tell': '告诉',
                    'ask': '问',
                    'answer': '回答',
                    'see': '看见',
                    'hear': '听见',
                    'feel': '感觉',
                    'know': '知道',
                    'think': '思考',
                    'learn': '学习',
                    'teach': '教',
                    'write': '写',
                    'read': '读',
                    'sing': '唱',
                    'dance': '跳舞',
                    'play': '玩',
                    'run': '跑',
                    'walk': '走',
                    'jump': '跳',
                    'swim': '游泳',
                    'fly': '飞',
                    'drive': '驾驶',
                    'stop': '停止',
                    'start': '开始',
                    'end': '结束',
                    'begin': '开始',
                    'finish': '完成',
                    'continue': '继续',
                    'help': '帮助',
                    'need': '需要',
                    'want': '想要',
                    'have': '有',
                    'be': '是',
                    'am': '是',
                    'is': '是',
                    'are': '是',
                    'was': '是',
                    'were': '是',
                    'will': '将',
                    'would': '会',
                    'can': '能',
                    'could': '能够',
                    'may': '可能',
                    'might': '可能',
                    'must': '必须',
                    'should': '应该',
                    'shall': '将要'
                }
            },
            'zh': {
                'en': {
                    '你好': 'hello',
                    '世界': 'world',
                    '帅气': 'handsome',
                    '帅气的': 'handsome',
                    '美丽': 'beautiful',
                    '美丽的': 'beautiful',
                    '好': 'good',
                    '好的': 'good',
                    '坏': 'bad',
                    '坏的': 'bad',
                    '是': 'yes',
                    '否': 'no',
                    '不': 'no',
                    '谢谢': 'thank you',
                    '你': 'you',
                    '我': 'I',
                    '他': 'he',
                    '她': 'she',
                    '我们': 'we',
                    '他们': 'they',
                    '爱': 'love',
                    '喜欢': 'like',
                    '讨厌': 'hate',
                    '朋友': 'friend',
                    '家庭': 'family',
                    '工作': 'work',
                    '学校': 'school',
                    '电脑': 'computer',
                    '手机': 'phone',
                    '书': 'book',
                    '时间': 'time',
                    '天': 'day',
                    '晚上': 'night',
                    '年': 'year',
                    '月': 'month',
                    '周': 'week',
                    '钱': 'money',
                    '食物': 'food',
                    '水': 'water',
                    '火': 'fire',
                    '地球': 'earth',
                    '天空': 'sky',
                    '太阳': 'sun',
                    '月亮': 'moon',
                    '星星': 'star',
                    '红色': 'red',
                    '蓝色': 'blue',
                    '绿色': 'green',
                    '黄色': 'yellow',
                    '黑色': 'black',
                    '白色': 'white',
                    '大': 'big',
                    '大的': 'big',
                    '小': 'small',
                    '小的': 'small',
                    '快乐': 'happy',
                    '快乐的': 'happy',
                    '悲伤': 'sad',
                    '悲伤的': 'sad',
                    '生气': 'angry',
                    '生气的': 'angry',
                    '兴奋': 'excited',
                    '兴奋的': 'excited',
                    '累': 'tired',
                    '累的': 'tired',
                    '饿': 'hungry',
                    '饿的': 'hungry',
                    '渴': 'thirsty',
                    '渴的': 'thirsty',
                    '热': 'hot',
                    '热的': 'hot',
                    '冷': 'cold',
                    '冷的': 'cold',
                    '新': 'new',
                    '新的': 'new',
                    '旧': 'old',
                    '旧的': 'old',
                    '正确': 'right',
                    '正确的': 'right',
                    '错误': 'wrong',
                    '错误的': 'wrong',
                    '快': 'fast',
                    '快的': 'fast',
                    '慢': 'slow',
                    '慢的': 'slow',
                    '高': 'high',
                    '高的': 'high',
                    '低': 'low',
                    '低的': 'low',
                    '长': 'long',
                    '长的': 'long',
                    '短': 'short',
                    '短的': 'short',
                    '强壮': 'strong',
                    '强壮的': 'strong',
                    '弱': 'weak',
                    '弱的': 'weak',
                    '聪明': 'smart',
                    '聪明的': 'smart',
                    '愚蠢': 'stupid',
                    '愚蠢的': 'stupid',
                    '容易': 'easy',
                    '容易的': 'easy',
                    '困难': 'difficult',
                    '困难的': 'difficult',
                    '早': 'early',
                    '早的': 'early',
                    '晚': 'late',
                    '晚的': 'late',
                    '第一': 'first',
                    '最后': 'last',
                    '一': 'one',
                    '二': 'two',
                    '三': 'three',
                    '四': 'four',
                    '五': 'five',
                    '六': 'six',
                    '七': 'seven',
                    '八': 'eight',
                    '九': 'nine',
                    '十': 'ten',
                    '百': 'hundred',
                    '千': 'thousand',
                    '百万': 'million'
                }
            }
        };
        
        // 字符计数功能
        sourceText.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
        
        // 交换语言功能
        swapLanguagesBtn.addEventListener('click', function() {
            if (sourceLanguage.value !== 'auto') {
                const temp = sourceLanguage.value;
                sourceLanguage.value = targetLanguage.value;
                targetLanguage.value = temp;
            }
            updateLanguageDisplay();
        });
        
        // 清空输入功能
        clearSourceBtn.addEventListener('click', function() {
            sourceText.value = '';
            charCount.textContent = '0';
            translationResult.textContent = '翻译结果将显示在这里';
        });
        
        // 复制结果功能
        copyResultBtn.addEventListener('click', function() {
            const textToCopy = translationResult.textContent;
            if (textToCopy && textToCopy !== '翻译结果将显示在这里') {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showNotification('已复制到剪贴板');
                }).catch(err => {
                    showNotification('复制失败，请手动复制', 'error');
                });
            }
        });
        
        // 翻译按钮点击事件
        translateBtn.addEventListener('click', function() {
            const text = sourceText.value.trim();
            if (!text) {
                showNotification('请输入要翻译的文本', 'error');
                return;
            }
            
            // 显示加载状态
            showLoading(true);
            
            // 调用翻译函数
            translateText(text, sourceLanguage.value, targetLanguage.value)
                .then(result => {
                    translationResult.textContent = result.translatedText;
                    if (result.detectedLanguage) {
                        detectedLanguageEl.textContent = getLanguageName(result.detectedLanguage);
                    }
                    updateLanguageDisplay();
                    showNotification('翻译完成');
                })
                .catch(error => {
                    console.error('翻译失败:', error);
                    translationResult.textContent = '翻译失败，请稍后重试';
                    showNotification('翻译失败', 'error');
                })
                .finally(() => {
                    showLoading(false);
                });
        });
        
        // 自动翻译功能
        let translateTimeout;
        sourceText.addEventListener('input', function() {
            clearTimeout(translateTimeout);
            translateTimeout = setTimeout(() => {
                const text = this.value.trim();
                if (text.length > 0) {
                    translateBtn.click();
                }
            }, 500);
        });
        
        // 显示/隐藏加载状态
        function showLoading(show) {
            if (show) {
                translationResult.classList.add('opacity-50');
                loadingIndicator.classList.remove('hidden');
            } else {
                translationResult.classList.remove('opacity-50');
                loadingIndicator.classList.add('hidden');
            }
        }
        
        // 显示通知
        function showNotification(message, type = 'success') {
            notificationMessage.textContent = message;
            
            // 根据类型设置不同颜色
            if (type === 'error') {
                notification.classList.remove('bg-green-500');
                notification.classList.add('bg-red-500');
            } else {
                notification.classList.remove('bg-red-500');
                notification.classList.add('bg-green-500');
            }
            
            // 显示通知
            notification.classList.remove('translate-y-20', 'opacity-0');
            notification.classList.add('translate-y-0', 'opacity-100');
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.remove('translate-y-0', 'opacity-100');
                notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
        
        // 更新语言显示
        function updateLanguageDisplay() {
            if (sourceLanguage.value === 'auto') {
                detectedLanguageEl.textContent = '检测语言';
            } else {
                detectedLanguageEl.textContent = getLanguageName(sourceLanguage.value);
            }
            resultLanguageEl.textContent = getLanguageName(targetLanguage.value);
        }
        
        // 获取语言名称
        function getLanguageName(code) {
            const languages = {
                'auto': '自动检测',
                'zh': '中文',
                'en': '英语',
                'ja': '日语',
                'ko': '韩语',
                'fr': '法语',
                'de': '德语',
                'es': '西班牙语',
                'ru': '俄语'
            };
            return languages[code] || code;
        }
        
        // 翻译函数 - 优先使用本地字典，然后再尝试API
        async function translateText(text, fromLang, toLang) {
            // 首先检测语言（如果需要）
            let detectedLang = fromLang;
            if (fromLang === 'auto') {
                detectedLang = detectLanguage(text);
            }
            
            // 首先尝试使用本地字典进行翻译
            let translatedText = translateUsingDictionary(text, detectedLang, toLang);
            
            // 如果本地字典翻译成功，直接返回结果
            if (translatedText !== null && translatedText !== text) {
                return {
                    translatedText: translatedText,
                    detectedLanguage: detectedLang
                };
            }
            
            // 如果本地字典没有找到翻译，尝试使用API
            try {
                // 使用MyMemory API作为备选
                const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${detectedLang}|${toLang}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API错误: ${response.status}`);
                }
                
                const data = await response.json();
                
                // 检查API返回的翻译是否有效
                if (data.responseData && data.responseData.translatedText && data.responseData.translatedText !== text) {
                    return {
                        translatedText: data.responseData.translatedText,
                        detectedLanguage: detectedLang
                    };
                }
            } catch (error) {
                console.warn('API调用失败:', error);
                // API调用失败，继续使用备用翻译
            }
            
            // 如果所有方法都失败，使用简单的回退翻译
            return {
                translatedText: getFallbackTranslation(text, toLang),
                detectedLanguage: detectedLang
            };
        }
        
        // 使用本地字典进行翻译
        function translateUsingDictionary(text, fromLang, toLang) {
            // 如果源语言和目标语言相同，直接返回原文
            if (fromLang === toLang) {
                return text;
            }
            
            // 检查字典是否包含该语言对
            if (!translationDictionary[fromLang] || !translationDictionary[fromLang][toLang]) {
                return null;
            }
            
            const dict = translationDictionary[fromLang][toLang];
            
            // 处理句子翻译 - 简单地分词并翻译每个单词
            // 注意：这是一个非常简单的实现，实际应用中需要更复杂的NLP处理
            const words = text.split(/\s+/);
            const translatedWords = words.map(word => {
                // 尝试直接匹配单词（考虑大小写）
                if (dict[word]) {
                    return dict[word];
                }
                // 尝试小写匹配
                const lowerWord = word.toLowerCase();
                if (dict[lowerWord]) {
                    return dict[lowerWord];
                }
                // 尝试去除标点符号后的匹配
                const cleanWord = word.replace(/[.,!?;:'"()\[\]]/g, '');
                if (cleanWord && dict[cleanWord]) {
                    return dict[cleanWord];
                }
                const lowerCleanWord = cleanWord.toLowerCase();
                if (lowerCleanWord && dict[lowerCleanWord]) {
                    return dict[lowerCleanWord];
                }
                // 如果没有找到匹配，返回原单词
                return word;
            });
            
            // 重新组合句子
            return translatedWords.join(' ');
        }
        
        // 备用翻译逻辑
        function getFallbackTranslation(text, targetLang) {
            // 根据目标语言添加前缀，表明这是机器翻译结果
            if (targetLang === 'zh') {
                return `[机器翻译] ${text}`;
            } else if (targetLang === 'en') {
                return `[Machine Translation] ${text}`;
            } else if (targetLang === 'ja') {
                return `[機械翻訳] ${text}`;
            } else if (targetLang === 'ko') {
                return `[기계 번역] ${text}`;
            } else if (targetLang === 'fr') {
                return `[Traduction automatique] ${text}`;
            } else if (targetLang === 'de') {
                return `[Maschinelle Übersetzung] ${text}`;
            } else if (targetLang === 'es') {
                return `[Traducción automática] ${text}`;
            } else if (targetLang === 'ru') {
                return `[Машинный перевод] ${text}`;
            } else {
                return `[Translation to ${getLanguageName(targetLang)}] ${text}`;
            }
        }
        
        // 语言检测函数
        function detectLanguage(text) {
            // 检查是否包含中文字符
            if (/[\u4e00-\u9fa5]/.test(text)) {
                return 'zh';
            }
            // 检查是否包含日文字符
            if (/[\u3040-\u30ff]/.test(text)) {
                return 'ja';
            }
            // 检查是否包含韩文字符
            if (/[\uac00-\ud7af]/.test(text)) {
                return 'ko';
            }
            // 检查是否包含俄文字符
            if (/[\u0400-\u04ff]/.test(text)) {
                return 'ru';
            }
            // 检查是否包含法文字符
            if (/[àâäçéèêëîïôöùûüÿ]/.test(text)) {
                return 'fr';
            }
            // 检查是否包含德文字符
            if (/[äöüß]/.test(text)) {
                return 'de';
            }
            // 检查是否包含西班牙文字符
            if (/[áéíóúüñ¿¡]/.test(text)) {
                return 'es';
            }
            // 默认返回英文
            return 'en';
        }
        
        // 初始化
        function init() {
            updateLanguageDisplay();
            
            // 为移动设备添加触摸反馈
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('touchstart', function() {
                    this.classList.add('scale-95');
                });
                btn.addEventListener('touchend', function() {
                    this.classList.remove('scale-95');
                });
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
